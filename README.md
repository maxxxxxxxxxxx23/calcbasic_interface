Awful code but here it is.
